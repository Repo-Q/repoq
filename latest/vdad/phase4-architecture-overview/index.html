
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Revolutionary repository quality analysis with ontological intelligence" name="description"/>
<meta content="RepoQ Contributors" name="author"/>
<link href="https://repo-q.github.io/repoq/latest/vdad/phase4-architecture-overview/" rel="canonical"/>
<link href="../phase3-requirements/" rel="prev"/>
<link href="../phase4-c4-diagrams/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.22" name="generator"/>
<title>Phase 4 - Architecture Overview - RepoQ - Semantic Meta-Quality Loop</title>
<link href="../../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="amber" data-md-color-primary="deep-purple" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#vdad-phase-4-architecture-overview">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="RepoQ - Semantic Meta-Quality Loop" class="md-header__button md-logo" data-md-component="logo" href="../.." title="RepoQ - Semantic Meta-Quality Loop">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            RepoQ - Semantic Meta-Quality Loop
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Phase 4 - Architecture Overview
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="amber" data-md-color-media="" data-md-color-primary="deep-purple" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="amber" data-md-color-media="" data-md-color-primary="deep-purple" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/Repo-Q/repoq" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    Repo-Q/repoq
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/installation/">
          
  
  
    
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../user-guide/usage/">
          
  
  
    
  
  User Guide

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../architecture/overview/">
          
  
  
    
  
  Architecture

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../tutorials/01-first-analysis/">
          
  
  
    
  
  Tutorials

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../ontology/meta-loop/">
          
  
  
    
  
  Advanced Topics

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../development/index.md">
          
  
  
    
  
  Development

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../phase1-domain-context/">
          
  
  
    
  
  VDAD Process

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../api/reference/">
          
  
  
    
  
  API Reference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../about/limitations/">
          
  
  
    
  
  About

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="RepoQ - Semantic Meta-Quality Loop" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="RepoQ - Semantic Meta-Quality Loop">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    RepoQ - Semantic Meta-Quality Loop
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/Repo-Q/repoq" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</div>
<div class="md-source__repository">
    Repo-Q/repoq
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/installation/">
<span class="md-ellipsis">
    Installation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/quickstart/">
<span class="md-ellipsis">
    Quick Start
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    User Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/usage/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/configuration/">
<span class="md-ellipsis">
    Configuration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/commands/">
<span class="md-ellipsis">
    CLI Commands
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/workflows/">
<span class="md-ellipsis">
    Workflows
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/overview/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/trs-framework/">
<span class="md-ellipsis">
    TRS Framework
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/rdf-export/">
<span class="md-ellipsis">
    RDF Export
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/baml-agent/">
<span class="md-ellipsis">
    BAML AI Agent
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/ontologist-agent/">
<span class="md-ellipsis">
    Ontologist Agent
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/analyzer-pipeline/">
<span class="md-ellipsis">
    Analyzer Pipeline
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/architecture-analyzer/">
<span class="md-ellipsis">
    Architecture Analyzer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/git-status-analyzer/">
<span class="md-ellipsis">
    Git Status Analyzer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/doc-code-sync-analyzer/">
<span class="md-ellipsis">
    Doc-Code Sync Analyzer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/stratification-guard/">
<span class="md-ellipsis">
    Stratification Guard
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Tutorials
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/01-first-analysis/">
<span class="md-ellipsis">
    First Analysis
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/02-custom-analyzer/">
<span class="md-ellipsis">
    Custom Analyzer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/03-ci-cd-integration/">
<span class="md-ellipsis">
    CI/CD Integration
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/04-advanced-filtering/">
<span class="md-ellipsis">
    Advanced Filtering
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/05-rdf-queries/">
<span class="md-ellipsis">
    RDF Queries
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/06-ai-agent-config/">
<span class="md-ellipsis">
    AI Agent Configuration
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Advanced Topics
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ontology/meta-loop/">
<span class="md-ellipsis">
    Meta-Quality Loop
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ontology/intelligence/">
<span class="md-ellipsis">
    Ontological Intelligence
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Development
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Development
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/index.md">
<span class="md-ellipsis">
    Development Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/uv-setup/">
<span class="md-ellipsis">
    uv Setup Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/CONTRIBUTING.md">
<span class="md-ellipsis">
    Contributing Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/testing.md">
<span class="md-ellipsis">
    Testing Strategy
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/mathematical-proof-quality-monotonicity/">
<span class="md-ellipsis">
    Mathematical Proof (Quality Monotonicity)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/formal-foundations-complete/">
<span class="md-ellipsis">
    Formal Foundations
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/formal-diagrams/">
<span class="md-ellipsis">
    Formal Diagrams
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/quality-loop-roadmap/">
<span class="md-ellipsis">
    Quality Loop Roadmap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/meta-loop-closure-roadmap/">
<span class="md-ellipsis">
    Meta-Loop Closure Roadmap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../development/tmp-artifacts-inventory/">
<span class="md-ellipsis">
    tmp/ Artifacts Inventory
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
<span class="md-ellipsis">
    VDAD Process
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            VDAD Process
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../phase1-domain-context/">
<span class="md-ellipsis">
    Phase 1 - Domain Context
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../phase1-stakeholders/">
<span class="md-ellipsis">
    Phase 1 - Stakeholders
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../phase2-value-register/">
<span class="md-ellipsis">
    Phase 2 - Value Register
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../phase3-requirements/">
<span class="md-ellipsis">
    Phase 3 - Requirements
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Phase 4 - Architecture Overview
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Phase 4 - Architecture Overview
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#executive-summary">
<span class="md-ellipsis">
      Executive Summary
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-architectural-principles">
<span class="md-ellipsis">
      1. Architectural Principles
    </span>
</a>
<nav aria-label="1. Architectural Principles" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-core-principles">
<span class="md-ellipsis">
      1.1 Core Principles
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-high-level-component-architecture">
<span class="md-ellipsis">
      2. High-Level Component Architecture
    </span>
</a>
<nav aria-label="2. High-Level Component Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#21-component-diagram-9-components">
<span class="md-ellipsis">
      2.1 Component Diagram (9 Components)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#22-component-responsibilities">
<span class="md-ellipsis">
      2.2 Component Responsibilities
    </span>
</a>
<nav aria-label="2.2 Component Responsibilities" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#221-cli-layer">
<span class="md-ellipsis">
      2.2.1 CLI Layer
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#222-analysis-engine">
<span class="md-ellipsis">
      2.2.2 Analysis Engine
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#223-quality-engine">
<span class="md-ellipsis">
      2.2.3 Quality Engine
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#224-ontology-engine">
<span class="md-ellipsis">
      2.2.4 Ontology Engine
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#225-normalization-any2math">
<span class="md-ellipsis">
      2.2.5 Normalization (Any2Math)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#226-certificate-vc">
<span class="md-ellipsis">
      2.2.6 Certificate &amp; VC
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#227-self-application-guard">
<span class="md-ellipsis">
      2.2.7 Self-Application Guard
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#228-configuration">
<span class="md-ellipsis">
      2.2.8 Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#229-ai-agent-phase-5-optional">
<span class="md-ellipsis">
      2.2.9 AI Agent (Phase 5, Optional)
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-data-flow-architecture">
<span class="md-ellipsis">
      3. Data Flow Architecture
    </span>
</a>
<nav aria-label="3. Data Flow Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-gate-evaluation-flow">
<span class="md-ellipsis">
      3.1 Gate Evaluation Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-self-analysis-flow-meta-self">
<span class="md-ellipsis">
      3.2 Self-Analysis Flow (meta-self)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-technology-stack">
<span class="md-ellipsis">
      4. Technology Stack
    </span>
</a>
<nav aria-label="4. Technology Stack" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-core-dependencies">
<span class="md-ellipsis">
      4.1 Core Dependencies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-deployment-options">
<span class="md-ellipsis">
      4.2 Deployment Options
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-architecture-validation">
<span class="md-ellipsis">
      5. Architecture Validation
    </span>
</a>
<nav aria-label="5. Architecture Validation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-requirements-coverage">
<span class="md-ellipsis">
      5.1 Requirements Coverage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-nfr-realization-strategies">
<span class="md-ellipsis">
      5.2 NFR Realization Strategies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-architectural-risks">
<span class="md-ellipsis">
      5.3 Architectural Risks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-success-criteria-phase-4">
<span class="md-ellipsis">
      6. Success Criteria (Phase 4)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#references">
<span class="md-ellipsis">
      References
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../phase4-c4-diagrams/">
<span class="md-ellipsis">
    Phase 4 - C4 Diagrams
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../phase4-adrs/">
<span class="md-ellipsis">
    Phase 4 - ADRs
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../phase4-nfr-realization/">
<span class="md-ellipsis">
    Phase 4 - NFR Realization
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../phase4-baml-agent/">
<span class="md-ellipsis">
    Phase 4 - BAML Agent
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-ellipsis">
    API Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/reference/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-ellipsis">
    About
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            About
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../about/limitations/">
<span class="md-ellipsis">
    Current Limitations
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#executive-summary">
<span class="md-ellipsis">
      Executive Summary
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#1-architectural-principles">
<span class="md-ellipsis">
      1. Architectural Principles
    </span>
</a>
<nav aria-label="1. Architectural Principles" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-core-principles">
<span class="md-ellipsis">
      1.1 Core Principles
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-high-level-component-architecture">
<span class="md-ellipsis">
      2. High-Level Component Architecture
    </span>
</a>
<nav aria-label="2. High-Level Component Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#21-component-diagram-9-components">
<span class="md-ellipsis">
      2.1 Component Diagram (9 Components)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#22-component-responsibilities">
<span class="md-ellipsis">
      2.2 Component Responsibilities
    </span>
</a>
<nav aria-label="2.2 Component Responsibilities" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#221-cli-layer">
<span class="md-ellipsis">
      2.2.1 CLI Layer
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#222-analysis-engine">
<span class="md-ellipsis">
      2.2.2 Analysis Engine
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#223-quality-engine">
<span class="md-ellipsis">
      2.2.3 Quality Engine
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#224-ontology-engine">
<span class="md-ellipsis">
      2.2.4 Ontology Engine
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#225-normalization-any2math">
<span class="md-ellipsis">
      2.2.5 Normalization (Any2Math)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#226-certificate-vc">
<span class="md-ellipsis">
      2.2.6 Certificate &amp; VC
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#227-self-application-guard">
<span class="md-ellipsis">
      2.2.7 Self-Application Guard
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#228-configuration">
<span class="md-ellipsis">
      2.2.8 Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#229-ai-agent-phase-5-optional">
<span class="md-ellipsis">
      2.2.9 AI Agent (Phase 5, Optional)
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-data-flow-architecture">
<span class="md-ellipsis">
      3. Data Flow Architecture
    </span>
</a>
<nav aria-label="3. Data Flow Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-gate-evaluation-flow">
<span class="md-ellipsis">
      3.1 Gate Evaluation Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-self-analysis-flow-meta-self">
<span class="md-ellipsis">
      3.2 Self-Analysis Flow (meta-self)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-technology-stack">
<span class="md-ellipsis">
      4. Technology Stack
    </span>
</a>
<nav aria-label="4. Technology Stack" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-core-dependencies">
<span class="md-ellipsis">
      4.1 Core Dependencies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-deployment-options">
<span class="md-ellipsis">
      4.2 Deployment Options
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-architecture-validation">
<span class="md-ellipsis">
      5. Architecture Validation
    </span>
</a>
<nav aria-label="5. Architecture Validation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-requirements-coverage">
<span class="md-ellipsis">
      5.1 Requirements Coverage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-nfr-realization-strategies">
<span class="md-ellipsis">
      5.2 NFR Realization Strategies
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-architectural-risks">
<span class="md-ellipsis">
      5.3 Architectural Risks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-success-criteria-phase-4">
<span class="md-ellipsis">
      6. Success Criteria (Phase 4)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#references">
<span class="md-ellipsis">
      References
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/Repo-Q/repoq/edit/main/docs/vdad/phase4-architecture-overview.md" rel="edit" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/Repo-Q/repoq/raw/main/docs/vdad/phase4-architecture-overview.md" title="View source of this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"></path></svg>
</a>
<h1 id="vdad-phase-4-architecture-overview">VDAD Phase 4: Architecture Overview<a class="headerlink" href="#vdad-phase-4-architecture-overview" title="Permanent link">¶</a></h1>
<p><strong>Status</strong>: ✅ ACTIVE<br/>
<strong>VDAD Step</strong>: Step 7 (Architecture Design)<br/>
<strong>Created</strong>: 2025-10-21<br/>
<strong>Last Updated</strong>: 2025-10-21</p>
<hr/>
<h2 id="executive-summary">Executive Summary<a class="headerlink" href="#executive-summary" title="Permanent link">¶</a></h2>
<p>This document presents the <strong>high-level architecture</strong> for RepoQ, designed to satisfy all 31 requirements from Phase 3 (19 FR + 12 NFR). The architecture follows Domain-Driven Design (DDD) with 4 bounded contexts, 9 major components, and clear separation of concerns.</p>
<p><strong>Key Architectural Decisions</strong>:
- <strong>Python-native core</strong> (no heavy external dependencies)
- <strong>Embedded RDF storage</strong> (RDFLib/Oxigraph, no external DB)
- <strong>Subprocess isolation</strong> (Lean runtime for Any2Math)
- <strong>Incremental analysis</strong> (caching by file SHA + policy version)
- <strong>Stratified self-application</strong> (L_0 → L_1 → L_2 with guard)
- <strong>Opt-in AI agent</strong> (BAML, Phase 5)</p>
<p><strong>Architecture Validation</strong>:
- ✅ Satisfies all 8 Tier 1 values (Transparency, Gaming Protection, Correctness, Monotonicity, Speed, Fairness, Reliability, Actionability)
- ✅ Meets all 12 NFRs (Speed ≤2 min, Determinism, Coverage ≥80%, Zero network calls)
- ✅ Addresses all 4 EVRs (Transparency, Gaming Protection, Fairness, Privacy)</p>
<hr/>
<h2 id="1-architectural-principles">1. Architectural Principles<a class="headerlink" href="#1-architectural-principles" title="Permanent link">¶</a></h2>
<h3 id="11-core-principles">1.1 Core Principles<a class="headerlink" href="#11-core-principles" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Formal Correctness First</strong> (P1)</li>
<li>Every metric, formula, guarantee is formally verified</li>
<li>14 theorems proven (Theorems A-H, 15.1-15.3, Any2Math.A-C)</li>
<li>
<p>Lean mechanization for TRS properties (confluence, termination)</p>
</li>
<li>
<p><strong>Local-First, Privacy-Preserving</strong> (P2)</p>
</li>
<li>All core analysis local (no network calls)</li>
<li>Self-hosted RDF storage (no external SaaS)</li>
<li>
<p>Opt-in AI only (explicit consent required)</p>
</li>
<li>
<p><strong>Performance Through Incremental Analysis</strong> (P3)</p>
</li>
<li>Cache metrics by file SHA + policy version</li>
<li>Only re-analyze changed files (git diff)</li>
<li>
<p>Target: ≤2 min (P90) for &lt;1K files</p>
</li>
<li>
<p><strong>Safe Self-Understanding</strong> (P4)</p>
</li>
<li>Stratified self-application (L_0 → L_1 → L_2)</li>
<li>SelfApplicationGuard enforces i &gt; j (strict ordering)</li>
<li>
<p>Dogfooding without paradoxes (Theorem F)</p>
</li>
<li>
<p><strong>Gaming-Resistant</strong> (P5)</p>
</li>
<li>PCQ min-aggregator (all modules ≥τ, no compensation)</li>
<li>Any2Math normalization (eliminates syntactic gaming)</li>
<li>
<p>AI anomaly detection (Phase 5, optional)</p>
</li>
<li>
<p><strong>Constructive Feedback</strong> (P6)</p>
</li>
<li>PCE k-repair witness (actionable fix path)</li>
<li>Detailed ΔQ breakdown (per-metric, per-file)</li>
<li>Exemptions for necessary complexity (inline/config)</li>
</ol>
<hr/>
<h2 id="2-high-level-component-architecture">2. High-Level Component Architecture<a class="headerlink" href="#2-high-level-component-architecture" title="Permanent link">¶</a></h2>
<h3 id="21-component-diagram-9-components">2.1 Component Diagram (9 Components)<a class="headerlink" href="#21-component-diagram-9-components" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>graph TB
    subgraph "CLI Layer"
        CLI[CLI Commands]
        CLI_GATE[repoq gate]
        CLI_VERIFY[repoq verify]
        CLI_META[repoq meta-self]
        CLI_EXPORT[repoq export]
    end

    subgraph "Analysis Engine"
        ANALYZER[AnalysisOrchestrator]
        METRICS[MetricCalculators]
        CACHE[MetricCache]
        INCREMENTAL[IncrementalAnalyzer]
    end

    subgraph "Quality Engine"
        Q_CALC[QualityCalculator]
        GATE_EVAL[GateEvaluator]
        PCQ[PCQ MinAggregator]
        PCE[PCE WitnessGenerator]
        ADMISSION[AdmissionPredicate]
    end

    subgraph "Ontology Engine"
        ONTOLOGY_MGR[OntologyManager]
        RDF_STORE[RDF TripleStore]
        SPARQL_ENGINE[SPARQL QueryEngine]
        PATTERN_DETECTOR[PatternDetector]
        INFERENCE[SemanticInference]
    end

    subgraph "Normalization (Any2Math)"
        TRS_ENGINE[TRS RewriteEngine]
        NORMALIZER[AST Normalizer]
        LEAN_BRIDGE[Lean ProofBridge]
    end

    subgraph "Certificate &amp; VC"
        VC_GEN[VC Generator]
        CERT_REGISTRY[Certificate Registry]
        SIGNATURE[ECDSA Signer]
    end

    subgraph "Self-Application Guard"
        STRAT_GUARD[StratificationGuard]
        LEVEL_TRACKER[LevelTracker]
        META_ANALYZER[MetaAnalyzer]
    end

    subgraph "Configuration"
        CONFIG_LOADER[PolicyLoader]
        YAML_PARSER[YAML Parser]
        VALIDATOR[ConfigValidator]
    end

    subgraph "AI Agent (Phase 5, Optional)"
        BAML_AGENT[BAML AIAgent]
        LLM_CLIENT[LLM Client]
        CONSENT_MGR[ConsentManager]
    end

    CLI --&gt; ANALYZER
    CLI_GATE --&gt; GATE_EVAL
    CLI_META --&gt; STRAT_GUARD

    ANALYZER --&gt; METRICS
    ANALYZER --&gt; CACHE
    ANALYZER --&gt; INCREMENTAL
    ANALYZER --&gt; NORMALIZER

    METRICS --&gt; Q_CALC
    Q_CALC --&gt; GATE_EVAL
    GATE_EVAL --&gt; ADMISSION
    GATE_EVAL --&gt; PCQ
    GATE_EVAL --&gt; PCE

    ANALYZER --&gt; ONTOLOGY_MGR
    ONTOLOGY_MGR --&gt; RDF_STORE
    ONTOLOGY_MGR --&gt; SPARQL_ENGINE
    ONTOLOGY_MGR --&gt; PATTERN_DETECTOR
    SPARQL_ENGINE --&gt; INFERENCE

    NORMALIZER --&gt; TRS_ENGINE
    TRS_ENGINE --&gt; LEAN_BRIDGE

    GATE_EVAL --&gt; VC_GEN
    VC_GEN --&gt; SIGNATURE
    VC_GEN --&gt; CERT_REGISTRY

    STRAT_GUARD --&gt; LEVEL_TRACKER
    STRAT_GUARD --&gt; META_ANALYZER
    META_ANALYZER --&gt; ANALYZER

    CLI --&gt; CONFIG_LOADER
    CONFIG_LOADER --&gt; YAML_PARSER
    YAML_PARSER --&gt; VALIDATOR

    CLI_GATE -.optional.-&gt; BAML_AGENT
    BAML_AGENT --&gt; CONSENT_MGR
    BAML_AGENT --&gt; LLM_CLIENT

    style CLI fill:#e1f5ff
    style ANALYZER fill:#fff4e1
    style Q_CALC fill:#e1ffe1
    style ONTOLOGY_MGR fill:#f0e1ff
    style TRS_ENGINE fill:#ffe1e1
    style VC_GEN fill:#ffe1f5
    style STRAT_GUARD fill:#e1f5ff
    style BAML_AGENT fill:#fff4e1,stroke-dasharray: 5 5</code></pre>
<h3 id="22-component-responsibilities">2.2 Component Responsibilities<a class="headerlink" href="#22-component-responsibilities" title="Permanent link">¶</a></h3>
<h4 id="221-cli-layer">2.2.1 CLI Layer<a class="headerlink" href="#221-cli-layer" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: CLI Commands<br/>
<strong>Responsibility</strong>: User interface, command parsing, output formatting<br/>
<strong>Key Classes</strong>: <code>GateCommand</code>, <code>VerifyCommand</code>, <code>MetaSelfCommand</code>, <code>ExportCommand</code><br/>
<strong>Requirements</strong>: FR-01, FR-03, FR-17, FR-18<br/>
<strong>Technology</strong>: Click (Python CLI framework)</p>
<hr/>
<h4 id="222-analysis-engine">2.2.2 Analysis Engine<a class="headerlink" href="#222-analysis-engine" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: AnalysisOrchestrator<br/>
<strong>Responsibility</strong>: Coordinate metric calculation, caching, incremental analysis<br/>
<strong>Key Classes</strong>: <code>AnalysisOrchestrator</code>, <code>IncrementalAnalyzer</code>, <code>MetricCache</code><br/>
<strong>Requirements</strong>: FR-10, NFR-01, NFR-05<br/>
<strong>Sub-components</strong>:
- <strong>MetricCalculators</strong>: Complexity (radon), Hotspots (git log), TODOs (regex), Coverage (coverage.py)
- <strong>MetricCache</strong>: SHA-based caching with LRU eviction
- <strong>IncrementalAnalyzer</strong>: Git diff parsing, delta-only analysis</p>
<p><strong>Cache Strategy</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">file_sha</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">policy_version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">repoq_version</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">if</span> <span class="n">cache_key</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="k">return</span> <span class="n">cached_metrics</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="k">return</span> <span class="n">metrics</span>
</span></code></pre></div></p>
<hr/>
<h4 id="223-quality-engine">2.2.3 Quality Engine<a class="headerlink" href="#223-quality-engine" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: QualityCalculator + GateEvaluator<br/>
<strong>Responsibility</strong>: Q-score calculation, admission predicate evaluation, PCQ/PCE<br/>
<strong>Key Classes</strong>: <code>QualityCalculator</code>, <code>GateEvaluator</code>, <code>PCQAggregator</code>, <code>PCEWitnessGenerator</code><br/>
<strong>Requirements</strong>: FR-04, FR-05, FR-08, FR-11, NFR-02, NFR-04  </p>
<p><strong>Q-Score Formula</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">Q</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">=</span> <span class="n">Q_max</span> <span class="o">-</span> <span class="n">Σ</span><span class="p">(</span><span class="n">w_i</span> <span class="o">*</span> <span class="n">x_i</span><span class="p">)</span> <span class="o">-</span> <span class="n">Φ</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">where</span><span class="p">:</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>  <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">complexity</span><span class="p">,</span> <span class="n">hotspots</span><span class="p">,</span> <span class="n">todos</span><span class="p">,</span> <span class="n">coverage_gap</span><span class="p">]</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>  <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>  <span class="c1"># configurable weights</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>  <span class="n">Φ</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">penalty</span> <span class="k">for</span> <span class="n">extreme</span> <span class="n">outliers</span> <span class="p">(</span><span class="n">optional</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Admission Predicate</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">admission</span><span class="p">(</span><span class="n">base</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">head</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="n">Policy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="n">H</span> <span class="o">=</span> <span class="n">hard_constraints_pass</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>  <span class="c1"># tests≥80%, TODO≤100, hotspots≤20</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>    <span class="n">delta_q</span> <span class="o">=</span> <span class="n">head</span><span class="o">.</span><span class="n">q</span> <span class="o">-</span> <span class="n">base</span><span class="o">.</span><span class="n">q</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>    <span class="n">pcq</span> <span class="o">=</span> <span class="n">calculate_pcq</span><span class="p">(</span><span class="n">head</span><span class="o">.</span><span class="n">modules</span><span class="p">)</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>    <span class="k">return</span> <span class="n">H</span> <span class="ow">and</span> <span class="p">(</span><span class="n">delta_q</span> <span class="o">&gt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pcq</span> <span class="o">&gt;=</span> <span class="n">policy</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
</span></code></pre></div></p>
<hr/>
<h4 id="224-ontology-engine">2.2.4 Ontology Engine<a class="headerlink" href="#224-ontology-engine" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: OntologyManager<br/>
<strong>Responsibility</strong>: RDF triple management, SPARQL queries, pattern detection, semantic inference<br/>
<strong>Key Classes</strong>: <code>OntologyManager</code>, <code>RDFStore</code>, <code>SPARQLEngine</code>, <code>PatternDetector</code><br/>
<strong>Requirements</strong>: FR-12 (ontology-based exemptions), V06 (Fairness), V15 (Extensibility)  </p>
<p><strong>Three-Ontology Architecture</strong>:
1. <strong>Code Ontology</strong> (O_Code): Functions, classes, calls, imports
2. <strong>C4 Ontology</strong> (O_C4): Components, containers, dependencies
3. <strong>DDD Ontology</strong> (O_DDD): Bounded contexts, aggregates, entities</p>
<p><strong>Pattern Detection</strong>:
<div class="language-sparql highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c"># Detect MVC pattern</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="k">SELECT</span> <span class="nv">?controller</span> <span class="nv">?model</span> <span class="nv">?view</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="k">WHERE</span> <span class="p">{</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>  <span class="nv">?controller</span> <span class="nn">rdf</span><span class="p">:</span><span class="nt">type</span> <span class="nn">code</span><span class="p">:</span><span class="nt">Class</span> <span class="p">.</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>  <span class="nv">?controller</span> <span class="nn">code</span><span class="p">:</span><span class="nt">name</span> <span class="nv">?name</span> <span class="p">.</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>  <span class="k">FILTER</span><span class="p">(</span><span class="nf">CONTAINS</span><span class="p">(</span><span class="nv">?name</span><span class="p">,</span> <span class="s">"Controller"</span><span class="p">))</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>  <span class="nv">?controller</span> <span class="nn">code</span><span class="p">:</span><span class="nt">calls</span> <span class="nv">?model</span> <span class="p">.</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>  <span class="nv">?model</span> <span class="nn">rdf</span><span class="p">:</span><span class="nt">type</span> <span class="nn">code</span><span class="p">:</span><span class="nt">Class</span> <span class="p">.</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>  <span class="k">FILTER</span><span class="p">(</span><span class="nf">CONTAINS</span><span class="p">(</span><span class="nv">?model</span><span class="p">.</span><span class="err">name</span><span class="p">,</span> <span class="s">"Model"</span><span class="p">))</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>  <span class="nv">?controller</span> <span class="nn">code</span><span class="p">:</span><span class="nt">renders</span> <span class="nv">?view</span> <span class="p">.</span>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>  <span class="nv">?view</span> <span class="nn">rdf</span><span class="p">:</span><span class="nt">type</span> <span class="nn">code</span><span class="p">:</span><span class="nt">Template</span> <span class="p">.</span>
</span><span id="__span-3-14"><a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="p">}</span>
</span></code></pre></div></p>
<hr/>
<h4 id="225-normalization-any2math">2.2.5 Normalization (Any2Math)<a class="headerlink" href="#225-normalization-any2math" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: TRS RewriteEngine + AST Normalizer<br/>
<strong>Responsibility</strong>: Deterministic AST canonicalization, TRS verification<br/>
<strong>Key Classes</strong>: <code>ASTNormalizer</code>, <code>TRSEngine</code>, <code>LeanProofBridge</code><br/>
<strong>Requirements</strong>: FR-06, FR-07, NFR-03 (Determinism)  </p>
<p><strong>TRS Rewrite Rules</strong> (examples):
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Rule 1: Remove redundant Pass statements</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">Pass</span> <span class="err">→</span> <span class="n">ε</span> <span class="p">(</span><span class="n">empty</span><span class="p">)</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="c1"># Rule 2: Normalize variable order in comprehensions</span>
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">if</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="err">→</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># Rule 3: Canonicalize binary ops (commutative)</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="err">→</span> <span class="n">sort</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sort</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a>
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="c1"># Rule 4: Remove unnecessary parentheses</span>
</span><span id="__span-4-11"><a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="err">→</span> <span class="n">a</span>  <span class="p">(</span><span class="k">if</span> <span class="n">no</span> <span class="n">precedence</span> <span class="n">change</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Lean Verification</strong> (subprocess):
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>lean<span class="w"> </span>verify_trs.lean<span class="w"> </span>--check<span class="w"> </span>confluence<span class="w"> </span>termination<span class="w"> </span>idempotence
</span></code></pre></div></p>
<hr/>
<h4 id="226-certificate-vc">2.2.6 Certificate &amp; VC<a class="headerlink" href="#226-certificate-vc" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: VC Generator<br/>
<strong>Responsibility</strong>: W3C Verifiable Credentials, ECDSA signing, registry<br/>
<strong>Key Classes</strong>: <code>VCGenerator</code>, <code>ECDSASigner</code>, <code>CertificateRegistry</code><br/>
<strong>Requirements</strong>: FR-19, V09 (Auditability)  </p>
<p><strong>VC Structure</strong>:
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">  </span><span class="nt">"@context"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://www.w3.org/2018/credentials/v1"</span><span class="p">],</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"VerifiableCredential"</span><span class="p">,</span><span class="w"> </span><span class="s2">"QualityAssessmentCredential"</span><span class="p">],</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">  </span><span class="nt">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:repoq:v1"</span><span class="p">,</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">  </span><span class="nt">"issuanceDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-10-21T10:30:00Z"</span><span class="p">,</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">  </span><span class="nt">"credentialSubject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="nt">"repository"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/kirill-0440/repoq"</span><span class="p">,</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="nt">"commit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"87b51c0..."</span><span class="p">,</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="nt">"q_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">82.5</span><span class="p">,</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="nt">"delta_q"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.3</span><span class="p">,</span>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="nt">"verdict"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="p">,</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="nt">"pcq"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.78</span><span class="p">,</span>
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">    </span><span class="nt">"policy_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v1.0.0"</span>
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-6-15"><a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">  </span><span class="nt">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-16"><a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EcdsaSecp256k1Signature2019"</span><span class="p">,</span>
</span><span id="__span-6-17"><a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">    </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-10-21T10:30:00Z"</span><span class="p">,</span>
</span><span id="__span-6-18"><a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="nt">"proofPurpose"</span><span class="p">:</span><span class="w"> </span><span class="s2">"assertionMethod"</span><span class="p">,</span>
</span><span id="__span-6-19"><a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">    </span><span class="nt">"verificationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:repoq:v1#key-1"</span><span class="p">,</span>
</span><span id="__span-6-20"><a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">    </span><span class="nt">"jws"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJhbGc...signature..."</span>
</span><span id="__span-6-21"><a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-22"><a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="p">}</span>
</span></code></pre></div></p>
<hr/>
<h4 id="227-self-application-guard">2.2.7 Self-Application Guard<a class="headerlink" href="#227-self-application-guard" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: StratificationGuard<br/>
<strong>Responsibility</strong>: Enforce safe self-analysis (L_0 → L_1 → L_2)<br/>
<strong>Key Classes</strong>: <code>StratificationGuard</code>, <code>LevelTracker</code>, <code>MetaAnalyzer</code><br/>
<strong>Requirements</strong>: FR-16, FR-17, V11 (Safety)  </p>
<p><strong>Stratification Enforcement</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">StratificationGuard</span><span class="p">:</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>        <span class="k">if</span> <span class="n">target_level</span> <span class="o">&lt;=</span> <span class="n">current_level</span><span class="p">:</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>            <span class="k">raise</span> <span class="n">StratificationViolation</span><span class="p">(</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>                <span class="sa">f</span><span class="s2">"Cannot analyze L_</span><span class="si">{</span><span class="n">target_level</span><span class="si">}</span><span class="s2"> from L_</span><span class="si">{</span><span class="n">current_level</span><span class="si">}</span><span class="s2">. "</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>                <span class="sa">f</span><span class="s2">"Theorem F requires strict ordering: i &gt; j."</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>            <span class="p">)</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>        <span class="k">if</span> <span class="n">target_level</span> <span class="o">-</span> <span class="n">current_level</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>            <span class="k">raise</span> <span class="n">StratificationViolation</span><span class="p">(</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>                <span class="sa">f</span><span class="s2">"Cannot skip levels. Analyze L_</span><span class="si">{</span><span class="n">current_level</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> first."</span>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a>            <span class="p">)</span>
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>        <span class="c1"># SAFE: target &gt; current and no skipping</span>
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a>        <span class="k">return</span> <span class="kc">True</span>
</span></code></pre></div></p>
<hr/>
<h4 id="228-configuration">2.2.8 Configuration<a class="headerlink" href="#228-configuration" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: PolicyLoader<br/>
<strong>Responsibility</strong>: Load, parse, validate <code>.github/quality-policy.yml</code><br/>
<strong>Key Classes</strong>: <code>PolicyLoader</code>, <code>YAMLParser</code>, <code>ConfigValidator</code><br/>
<strong>Requirements</strong>: FR-09, V06 (Fairness - configurable weights)  </p>
<p><strong>Policy Schema</strong>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">"1.0"</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="nt">weights</span><span class="p">:</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">  </span><span class="nt">complexity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">  </span><span class="nt">hotspots</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">  </span><span class="nt">todos</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">  </span><span class="nt">coverage_gap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40</span>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="nt">thresholds</span><span class="p">:</span>
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">  </span><span class="nt">epsilon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span><span class="w">        </span><span class="c1"># ΔQ noise tolerance</span>
</span><span id="__span-8-11"><a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">  </span><span class="nt">tau</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.8</span><span class="w">            </span><span class="c1"># PCQ threshold</span>
</span><span id="__span-8-12"><a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="w">  </span><span class="nt">q_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
</span><span id="__span-8-13"><a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a>
</span><span id="__span-8-14"><a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="nt">hard_constraints</span><span class="p">:</span>
</span><span id="__span-8-15"><a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="w">  </span><span class="nt">test_coverage_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.80</span>
</span><span id="__span-8-16"><a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="w">  </span><span class="nt">todo_count_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
</span><span id="__span-8-17"><a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="w">  </span><span class="nt">hotspot_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</span><span id="__span-8-18"><a href="#__codelineno-8-18" id="__codelineno-8-18" name="__codelineno-8-18"></a>
</span><span id="__span-8-19"><a href="#__codelineno-8-19" id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="nt">exemptions</span><span class="p">:</span>
</span><span id="__span-8-20"><a href="#__codelineno-8-20" id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="w">  </span><span class="nt">complexity</span><span class="p">:</span>
</span><span id="__span-8-21"><a href="#__codelineno-8-21" id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">"algorithms/*.py"</span>
</span><span id="__span-8-22"><a href="#__codelineno-8-22" id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="w">      </span><span class="nt">max_complexity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</span><span id="__span-8-23"><a href="#__codelineno-8-23" id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="w">      </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="s">"Graph</span><span class="nv"> </span><span class="s">algorithms</span><span class="nv"> </span><span class="s">naturally</span><span class="nv"> </span><span class="s">complex"</span>
</span><span id="__span-8-24"><a href="#__codelineno-8-24" id="__codelineno-8-24" name="__codelineno-8-24"></a>
</span><span id="__span-8-25"><a href="#__codelineno-8-25" id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="w">  </span><span class="nt">legacy</span><span class="p">:</span>
</span><span id="__span-8-26"><a href="#__codelineno-8-26" id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">"legacy_module/"</span>
</span><span id="__span-8-27"><a href="#__codelineno-8-27" id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="w">      </span><span class="nt">expires</span><span class="p">:</span><span class="w"> </span><span class="s">"2026-06-01"</span>
</span><span id="__span-8-28"><a href="#__codelineno-8-28" id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="w">      </span><span class="nt">reason</span><span class="p">:</span><span class="w"> </span><span class="s">"Gradual</span><span class="nv"> </span><span class="s">refactoring</span><span class="nv"> </span><span class="s">plan"</span>
</span><span id="__span-8-29"><a href="#__codelineno-8-29" id="__codelineno-8-29" name="__codelineno-8-29"></a>
</span><span id="__span-8-30"><a href="#__codelineno-8-30" id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="nt">pcq</span><span class="p">:</span>
</span><span id="__span-8-31"><a href="#__codelineno-8-31" id="__codelineno-8-31" name="__codelineno-8-31"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-8-32"><a href="#__codelineno-8-32" id="__codelineno-8-32" name="__codelineno-8-32"></a><span class="w">  </span><span class="nt">module_type</span><span class="p">:</span><span class="w"> </span><span class="s">"directory"</span><span class="w">  </span><span class="c1"># or "layer", "bounded_context"</span>
</span><span id="__span-8-33"><a href="#__codelineno-8-33" id="__codelineno-8-33" name="__codelineno-8-33"></a>
</span><span id="__span-8-34"><a href="#__codelineno-8-34" id="__codelineno-8-34" name="__codelineno-8-34"></a><span class="nt">ai_agent</span><span class="p">:</span>
</span><span id="__span-8-35"><a href="#__codelineno-8-35" id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># opt-in only</span>
</span><span id="__span-8-36"><a href="#__codelineno-8-36" id="__codelineno-8-36" name="__codelineno-8-36"></a><span class="w">  </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="s">"openai"</span>
</span><span id="__span-8-37"><a href="#__codelineno-8-37" id="__codelineno-8-37" name="__codelineno-8-37"></a><span class="w">  </span><span class="nt">api_key_env</span><span class="p">:</span><span class="w"> </span><span class="s">"REPOQ_AI_API_KEY"</span>
</span></code></pre></div></p>
<hr/>
<h4 id="229-ai-agent-phase-5-optional">2.2.9 AI Agent (Phase 5, Optional)<a class="headerlink" href="#229-ai-agent-phase-5-optional" title="Permanent link">¶</a></h4>
<p><strong>Component</strong>: BAML AIAgent<br/>
<strong>Responsibility</strong>: Semantic analysis, improvement suggestions, anomaly detection<br/>
<strong>Key Classes</strong>: <code>BAMLAgent</code>, <code>LLMClient</code>, <code>ConsentManager</code><br/>
<strong>Requirements</strong>: FR-15, V08 (Actionability), V12 (Learning)<br/>
<strong>Status</strong>: ⏸️ Planned (Phase 5)</p>
<p><strong>BAML Functions</strong> (4 functions):
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>// Function 1: Semantic Code Analysis
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>function AnalyzePRContext(diff: string, metrics: Metrics) -&gt; PRContext {
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>  client GPT4
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>  prompt #"
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>    Analyze this PR:
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>    Diff: {{ diff }}
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>    Metrics: {{ metrics }}
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>    Extract:
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>    - Intent: What is developer trying to accomplish?
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>    - Patterns: Design patterns used?
</span><span id="__span-9-12"><a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>    - Risks: Potential issues?
</span><span id="__span-9-13"><a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a>  "#
</span><span id="__span-9-14"><a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a>}
</span><span id="__span-9-15"><a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a>
</span><span id="__span-9-16"><a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a>// Function 2: Explanation Generation
</span><span id="__span-9-17"><a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a>function GenerateExplanation(failure: GateFailure) -&gt; Explanation {
</span><span id="__span-9-18"><a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a>  client GPT4
</span><span id="__span-9-19"><a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a>  prompt #"
</span><span id="__span-9-20"><a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a>    Gate failed:
</span><span id="__span-9-21"><a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a>    Reason: {{ failure.reason }}
</span><span id="__span-9-22"><a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a>    Metrics: {{ failure.metrics }}
</span><span id="__span-9-23"><a href="#__codelineno-9-23" id="__codelineno-9-23" name="__codelineno-9-23"></a>
</span><span id="__span-9-24"><a href="#__codelineno-9-24" id="__codelineno-9-24" name="__codelineno-9-24"></a>    Generate human-friendly explanation:
</span><span id="__span-9-25"><a href="#__codelineno-9-25" id="__codelineno-9-25" name="__codelineno-9-25"></a>    - Why it failed (avoid jargon)
</span><span id="__span-9-26"><a href="#__codelineno-9-26" id="__codelineno-9-26" name="__codelineno-9-26"></a>    - What to fix (specific files/functions)
</span><span id="__span-9-27"><a href="#__codelineno-9-27" id="__codelineno-9-27" name="__codelineno-9-27"></a>    - How to fix (concrete steps)
</span><span id="__span-9-28"><a href="#__codelineno-9-28" id="__codelineno-9-28" name="__codelineno-9-28"></a>  "#
</span><span id="__span-9-29"><a href="#__codelineno-9-29" id="__codelineno-9-29" name="__codelineno-9-29"></a>}
</span><span id="__span-9-30"><a href="#__codelineno-9-30" id="__codelineno-9-30" name="__codelineno-9-30"></a>
</span><span id="__span-9-31"><a href="#__codelineno-9-31" id="__codelineno-9-31" name="__codelineno-9-31"></a>// Function 3: Improvement Suggestions
</span><span id="__span-9-32"><a href="#__codelineno-9-32" id="__codelineno-9-32" name="__codelineno-9-32"></a>function SuggestImprovements(code: string, complexity: int) -&gt; Suggestions {
</span><span id="__span-9-33"><a href="#__codelineno-9-33" id="__codelineno-9-33" name="__codelineno-9-33"></a>  client GPT4
</span><span id="__span-9-34"><a href="#__codelineno-9-34" id="__codelineno-9-34" name="__codelineno-9-34"></a>  prompt #"
</span><span id="__span-9-35"><a href="#__codelineno-9-35" id="__codelineno-9-35" name="__codelineno-9-35"></a>    Code: {{ code }}
</span><span id="__span-9-36"><a href="#__codelineno-9-36" id="__codelineno-9-36" name="__codelineno-9-36"></a>    Complexity: {{ complexity }}
</span><span id="__span-9-37"><a href="#__codelineno-9-37" id="__codelineno-9-37" name="__codelineno-9-37"></a>
</span><span id="__span-9-38"><a href="#__codelineno-9-38" id="__codelineno-9-38" name="__codelineno-9-38"></a>    Suggest refactorings:
</span><span id="__span-9-39"><a href="#__codelineno-9-39" id="__codelineno-9-39" name="__codelineno-9-39"></a>    - Extract helper functions
</span><span id="__span-9-40"><a href="#__codelineno-9-40" id="__codelineno-9-40" name="__codelineno-9-40"></a>    - Simplify conditionals
</span><span id="__span-9-41"><a href="#__codelineno-9-41" id="__codelineno-9-41" name="__codelineno-9-41"></a>    - Apply design patterns
</span><span id="__span-9-42"><a href="#__codelineno-9-42" id="__codelineno-9-42" name="__codelineno-9-42"></a>  "#
</span><span id="__span-9-43"><a href="#__codelineno-9-43" id="__codelineno-9-43" name="__codelineno-9-43"></a>}
</span><span id="__span-9-44"><a href="#__codelineno-9-44" id="__codelineno-9-44" name="__codelineno-9-44"></a>
</span><span id="__span-9-45"><a href="#__codelineno-9-45" id="__codelineno-9-45" name="__codelineno-9-45"></a>// Function 4: Anomaly Detection
</span><span id="__span-9-46"><a href="#__codelineno-9-46" id="__codelineno-9-46" name="__codelineno-9-46"></a>function DetectAnomalies(history: List[Commit]) -&gt; Anomalies {
</span><span id="__span-9-47"><a href="#__codelineno-9-47" id="__codelineno-9-47" name="__codelineno-9-47"></a>  client GPT4
</span><span id="__span-9-48"><a href="#__codelineno-9-48" id="__codelineno-9-48" name="__codelineno-9-48"></a>  prompt #"
</span><span id="__span-9-49"><a href="#__codelineno-9-49" id="__codelineno-9-49" name="__codelineno-9-49"></a>    Commit history: {{ history }}
</span><span id="__span-9-50"><a href="#__codelineno-9-50" id="__codelineno-9-50" name="__codelineno-9-50"></a>
</span><span id="__span-9-51"><a href="#__codelineno-9-51" id="__codelineno-9-51" name="__codelineno-9-51"></a>    Detect suspicious patterns:
</span><span id="__span-9-52"><a href="#__codelineno-9-52" id="__codelineno-9-52" name="__codelineno-9-52"></a>    - Sudden coverage spike (gaming?)
</span><span id="__span-9-53"><a href="#__codelineno-9-53" id="__codelineno-9-53" name="__codelineno-9-53"></a>    - Trivial tests (assert True)
</span><span id="__span-9-54"><a href="#__codelineno-9-54" id="__codelineno-9-54" name="__codelineno-9-54"></a>    - Whitespace-only commits
</span><span id="__span-9-55"><a href="#__codelineno-9-55" id="__codelineno-9-55" name="__codelineno-9-55"></a>  "#
</span><span id="__span-9-56"><a href="#__codelineno-9-56" id="__codelineno-9-56" name="__codelineno-9-56"></a>}
</span></code></pre></div></p>
<p><strong>Security Boundaries</strong>:
- Read-only repository access (no writes)
- Max 10 LLM calls per analysis (cost control)
- Timeout: 30 seconds per function
- No external network except LLM API
- API key from env var (not committed)</p>
<hr/>
<h2 id="3-data-flow-architecture">3. Data Flow Architecture<a class="headerlink" href="#3-data-flow-architecture" title="Permanent link">¶</a></h2>
<h3 id="31-gate-evaluation-flow">3.1 Gate Evaluation Flow<a class="headerlink" href="#31-gate-evaluation-flow" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant CLI
    participant Config
    participant Analyzer
    participant Cache
    participant Normalizer
    participant Ontology
    participant Quality
    participant Gate
    participant VC

    User-&gt;&gt;CLI: repoq gate --base main --head HEAD
    CLI-&gt;&gt;Config: Load quality-policy.yml
    Config--&gt;&gt;CLI: Policy(ε=0.3, τ=0.8, weights)

    CLI-&gt;&gt;Analyzer: Analyze(base, head, policy)
    Analyzer-&gt;&gt;Analyzer: Git diff (changed files)

    loop For each changed file
        Analyzer-&gt;&gt;Cache: Get cached metrics
        alt Cache hit
            Cache--&gt;&gt;Analyzer: Cached metrics
        else Cache miss
            Analyzer-&gt;&gt;Normalizer: Normalize AST
            Normalizer--&gt;&gt;Analyzer: Canonical AST
            Analyzer-&gt;&gt;Analyzer: Calculate metrics
            Analyzer-&gt;&gt;Cache: Store metrics
        end
    end

    Analyzer-&gt;&gt;Ontology: Ingest code (optional)
    Ontology--&gt;&gt;Analyzer: Detected patterns

    Analyzer-&gt;&gt;Quality: Calculate Q(base), Q(head)
    Quality--&gt;&gt;Analyzer: Q_base=75.2, Q_head=77.8

    Analyzer-&gt;&gt;Gate: Evaluate admission predicate
    Gate-&gt;&gt;Gate: Check hard constraints (H)
    Gate-&gt;&gt;Gate: Check ΔQ ≥ ε (2.6 ≥ 0.3 ✓)
    Gate-&gt;&gt;Gate: Calculate PCQ (min=0.78)
    Gate-&gt;&gt;Gate: Check PCQ ≥ τ (0.78 &lt; 0.8 ✗)
    Gate--&gt;&gt;CLI: FAIL (PCQ below threshold)

    Gate-&gt;&gt;Gate: Generate PCE witness (k=3)
    Gate--&gt;&gt;CLI: Witness: [auth.py, login.py, session.py]

    CLI-&gt;&gt;VC: Generate certificate (FAIL)
    VC--&gt;&gt;CLI: VC with signature

    CLI-&gt;&gt;User: Exit code 1, detailed output, PCE witness</code></pre>
<h3 id="32-self-analysis-flow-meta-self">3.2 Self-Analysis Flow (meta-self)<a class="headerlink" href="#32-self-analysis-flow-meta-self" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant CLI
    participant Guard
    participant Analyzer
    participant MetaAnalyzer
    participant Ontology

    User-&gt;&gt;CLI: repoq meta-self --level 2
    CLI-&gt;&gt;Guard: Check stratification (L_0 → L_2)
    Guard-&gt;&gt;Guard: Verify i &gt; j (2 &gt; 0 ✓)
    Guard-&gt;&gt;Guard: No level skipping (2 - 0 = 2 ✗)
    Guard--&gt;&gt;CLI: FAIL: Cannot skip levels. Run --level 1 first.

    User-&gt;&gt;CLI: repoq meta-self --level 1
    CLI-&gt;&gt;Guard: Check stratification (L_0 → L_1)
    Guard-&gt;&gt;Guard: Verify 1 &gt; 0 ✓, no skipping ✓
    Guard--&gt;&gt;CLI: SAFE

    CLI-&gt;&gt;Analyzer: Analyze RepoQ codebase (level=1)
    Analyzer--&gt;&gt;CLI: Q(RepoQ)=82.5, patterns=[Layered, Plugin]

    User-&gt;&gt;CLI: repoq meta-self --level 2
    CLI-&gt;&gt;Guard: Check stratification (L_1 → L_2)
    Guard-&gt;&gt;Guard: Verify 2 &gt; 1 ✓, 2-1=1 ✓
    Guard--&gt;&gt;CLI: SAFE

    CLI-&gt;&gt;MetaAnalyzer: Meta-check (level=2)
    MetaAnalyzer-&gt;&gt;Ontology: Load RepoQ's own ontology
    MetaAnalyzer-&gt;&gt;MetaAnalyzer: Validate RepoQ ontology vs SHACL shapes
    MetaAnalyzer-&gt;&gt;MetaAnalyzer: Verify TRS confluence (Lean proof)
    MetaAnalyzer-&gt;&gt;MetaAnalyzer: Check PCQ computation correctness
    MetaAnalyzer--&gt;&gt;CLI: Meta-check PASS ✓

    CLI-&gt;&gt;User: SUCCESS: RepoQ is self-consistent at L_2</code></pre>
<hr/>
<h2 id="4-technology-stack">4. Technology Stack<a class="headerlink" href="#4-technology-stack" title="Permanent link">¶</a></h2>
<h3 id="41-core-dependencies">4.1 Core Dependencies<a class="headerlink" href="#41-core-dependencies" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
<th>Rationale</th>
<th>Alternative Considered</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>CLI</strong></td>
<td>Click 8.x</td>
<td>Rich CLI features, well-tested</td>
<td>Typer (rejected: overkill), argparse (rejected: verbose)</td>
</tr>
<tr>
<td><strong>AST Parsing</strong></td>
<td>Python <code>ast</code></td>
<td>Built-in, zero deps</td>
<td>LibCST (rejected: too heavy), astroid (rejected: complex)</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td>radon 6.x</td>
<td>Industry standard (McCabe)</td>
<td>pylint (rejected: slow), flake8 (rejected: linter, not metric)</td>
</tr>
<tr>
<td><strong>Coverage</strong></td>
<td>coverage.py 7.x</td>
<td>De facto standard</td>
<td>pytest-cov (rejected: wrapper, not needed)</td>
</tr>
<tr>
<td><strong>RDF</strong></td>
<td>RDFLib 7.x</td>
<td>Python-native, standards-compliant</td>
<td>Oxigraph (alternative: faster, but C++ dep)</td>
</tr>
<tr>
<td><strong>SPARQL</strong></td>
<td>RDFLib built-in</td>
<td>Integrated with RDFLib</td>
<td>Virtuoso (rejected: external server)</td>
</tr>
<tr>
<td><strong>SHACL</strong></td>
<td>pySHACL 0.25.x</td>
<td>W3C SHACL validation</td>
<td>Custom validator (rejected: reinventing wheel)</td>
</tr>
<tr>
<td><strong>VC Signing</strong></td>
<td>cryptography 42.x</td>
<td>Industry standard (ECDSA)</td>
<td>PyCryptodome (rejected: less maintained)</td>
</tr>
<tr>
<td><strong>Config</strong></td>
<td>PyYAML 6.x</td>
<td>YAML parsing standard</td>
<td>TOML (rejected: less flexible), JSON (rejected: no comments)</td>
</tr>
<tr>
<td><strong>Git</strong></td>
<td>GitPython 3.x</td>
<td>Git operations</td>
<td>subprocess (rejected: lower-level)</td>
</tr>
<tr>
<td><strong>Testing</strong></td>
<td>pytest 8.x</td>
<td>Industry standard</td>
<td>unittest (rejected: verbose), nose (rejected: unmaintained)</td>
</tr>
<tr>
<td><strong>Lean (optional)</strong></td>
<td>Lean 4</td>
<td>Mechanized proofs</td>
<td>Coq (rejected: steeper curve), Isabelle (rejected: less momentum)</td>
</tr>
<tr>
<td><strong>AI Agent (Phase 5)</strong></td>
<td>BAML 0.x</td>
<td>Type-safe LLM</td>
<td>LangChain (rejected: overengineered), raw OpenAI (rejected: no types)</td>
</tr>
</tbody>
</table>
<h3 id="42-deployment-options">4.2 Deployment Options<a class="headerlink" href="#42-deployment-options" title="Permanent link">¶</a></h3>
<ol>
<li>
<p><strong>Local Installation</strong> (Primary)
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>pip<span class="w"> </span>install<span class="w"> </span>repoq
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>repoq<span class="w"> </span>gate<span class="w"> </span>--base<span class="w"> </span>main<span class="w"> </span>--head<span class="w"> </span>HEAD
</span></code></pre></div></p>
</li>
<li>
<p><strong>GitHub Actions</strong> (CI/CD)
   <div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install repoq</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repoq gate --base ${{ github.event.pull_request.base.sha }} --head ${{ github.sha }}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Docker</strong> (Reproducibility)
   <div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>repoq
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">"repoq"</span><span class="p">]</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Pre-commit Hook</strong> (Local Validation)
   <div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># .pre-commit-config.yaml</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="nt">repos</span><span class="p">:</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/kirill-0440/repoq</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0.0</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="nt">hooks</span><span class="p">:</span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">repoq-gate</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">--base</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">origin/main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">--head</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">HEAD</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p>
</li>
</ol>
<hr/>
<h2 id="5-architecture-validation">5. Architecture Validation<a class="headerlink" href="#5-architecture-validation" title="Permanent link">¶</a></h2>
<h3 id="51-requirements-coverage">5.1 Requirements Coverage<a class="headerlink" href="#51-requirements-coverage" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Component(s)</th>
<th>Validation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>FR-01</strong></td>
<td>CLI, GateEvaluator</td>
<td>✅ Detailed output implemented</td>
</tr>
<tr>
<td><strong>FR-02</strong></td>
<td>PCEWitnessGenerator</td>
<td>🔄 In Progress (tmp/zag)</td>
</tr>
<tr>
<td><strong>FR-04</strong></td>
<td>PCQAggregator</td>
<td>🔄 In Progress (tmp/zag)</td>
</tr>
<tr>
<td><strong>FR-06</strong></td>
<td>ASTNormalizer, TRSEngine</td>
<td>⏸️ Planned (tmp/any2math)</td>
</tr>
<tr>
<td><strong>FR-08</strong></td>
<td>AdmissionPredicate</td>
<td>✅ Implemented (simplified)</td>
</tr>
<tr>
<td><strong>FR-10</strong></td>
<td>IncrementalAnalyzer, MetricCache</td>
<td>⏸️ Planned</td>
</tr>
<tr>
<td><strong>FR-14</strong></td>
<td>All components</td>
<td>✅ Zero network calls</td>
</tr>
<tr>
<td><strong>FR-16</strong></td>
<td>StratificationGuard</td>
<td>🔄 In Progress (tmp/meta-loop)</td>
</tr>
<tr>
<td><strong>FR-19</strong></td>
<td>VCGenerator</td>
<td>✅ Implemented</td>
</tr>
<tr>
<td><strong>NFR-01</strong></td>
<td>IncrementalAnalyzer</td>
<td>⏸️ Needs optimization (current: ~3 min)</td>
</tr>
<tr>
<td><strong>NFR-03</strong></td>
<td>ASTNormalizer</td>
<td>🔄 Partial (needs Any2Math)</td>
</tr>
<tr>
<td><strong>NFR-04</strong></td>
<td>AdmissionPredicate</td>
<td>✅ Proven (Theorem B)</td>
</tr>
<tr>
<td><strong>NFR-09</strong></td>
<td>All components</td>
<td>✅ Validated (zero network)</td>
</tr>
<tr>
<td><strong>NFR-10</strong></td>
<td>Test suite</td>
<td>🔄 Current: 64%, target: 80%</td>
</tr>
</tbody>
</table>
<p><strong>Coverage</strong>: 31/31 requirements addressed in architecture (26% implemented, 19% in progress, 55% planned)</p>
<h3 id="52-nfr-realization-strategies">5.2 NFR Realization Strategies<a class="headerlink" href="#52-nfr-realization-strategies" title="Permanent link">¶</a></h3>
<p>See <code>phase4-nfr-realization.md</code> for detailed strategies for each NFR.</p>
<h3 id="53-architectural-risks">5.3 Architectural Risks<a class="headerlink" href="#53-architectural-risks" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Risk</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>R1: Any2Math complexity</strong></td>
<td>Subprocess isolation, fallback to non-normalized mode</td>
</tr>
<tr>
<td><strong>R2: RDF performance</strong></td>
<td>Oxigraph (C++) as alternative to RDFLib (Python)</td>
</tr>
<tr>
<td><strong>R3: Cache invalidation bugs</strong></td>
<td>Policy version in cache key, comprehensive tests</td>
</tr>
<tr>
<td><strong>R4: Lean runtime unavailable</strong></td>
<td>Optional dependency, skip proofs if missing</td>
</tr>
<tr>
<td><strong>R5: PCE witness computation slow</strong></td>
<td>Greedy algorithm (O(n log n)), max k=8 limit</td>
</tr>
<tr>
<td><strong>R6: AI agent hallucinations</strong></td>
<td>Human-in-loop, experimental mode first, type-safe BAML</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="6-success-criteria-phase-4">6. Success Criteria (Phase 4)<a class="headerlink" href="#6-success-criteria-phase-4" title="Permanent link">¶</a></h2>
<ul>
<li>✅ <strong>High-level architecture</strong>: 9 components documented</li>
<li>✅ <strong>Component responsibilities</strong>: Clear single responsibility per component</li>
<li>✅ <strong>Data flow</strong>: 2 sequence diagrams (gate, meta-self)</li>
<li>✅ <strong>Technology stack</strong>: Justified choices with alternatives considered</li>
<li>✅ <strong>Requirements coverage</strong>: 31/31 requirements mapped to components</li>
<li>⏭️ <strong>Next</strong>: C4 diagrams (Context, Container, Component) → <code>phase4-c4-diagrams.md</code></li>
<li>⏭️ <strong>Next</strong>: ADR log (10+ decisions) → <code>phase4-adrs.md</code></li>
<li>⏭️ <strong>Next</strong>: NFR realization (12 strategies) → <code>phase4-nfr-realization.md</code></li>
<li>⏭️ <strong>Next</strong>: BAML AI agent spec → <code>phase4-baml-agent.md</code></li>
</ul>
<hr/>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">¶</a></h2>
<ol>
<li>Eric Evans (2003). <em>Domain-Driven Design</em>. Addison-Wesley — DDD bounded contexts</li>
<li>Simon Brown (2020). <em>The C4 Model</em>. <a href="https://c4model.com">c4model.com</a> — Architecture diagrams</li>
<li>Martin Fowler (2019). <em>Software Architecture Guide</em>. <a href="https://martinfowler.com/architecture/">martinfowler.com</a> — Component design</li>
<li>RepoQ Project (2025). <em>Phase 3: Requirements</em>. <code>docs/vdad/phase3-requirements.md</code> — 31 requirements</li>
<li>RepoQ Project (2025). <em>Phase 1: Domain Context</em>. <code>docs/vdad/phase1-domain-context.md</code> — 4 bounded contexts</li>
</ol>
<hr/>
<p><strong>Document Status</strong>: ✅ COMPLETE<br/>
<strong>Review</strong>: Pending (validate architecture with team)<br/>
<strong>Next Steps</strong>: Create C4 diagrams, ADR log, NFR realization, BAML spec in separate documents.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2025 RepoQ Contributors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/Repo-Q/repoq" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://pypi.org/project/repoq/" rel="noopener" target="_blank" title="pypi.org">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.highlight", "search.share", "header.autohide", "content.code.copy", "content.code.annotate", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
</body>
</html>