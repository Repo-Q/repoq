@prefix adr: <https://repoq.io/adr#> .
@prefix vdad: <https://repoq.io/vdad#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# ============================================================================
# ADR-014: Single Source of Truth — .repoq/ for all RDF artifacts
# ============================================================================

adr:adr-014 a adr:ArchitectureDecisionRecord ;
    adr:id "adr-014" ;
    adr:title "Single Source of Truth — .repoq/ for all RDF artifacts" ;
    adr:status adr:accepted ;
    adr:date "2025-01-15"^^xsd:date ;

    # Context
    adr:context [
        a adr:Context ;
        adr:problem """В проекте существует несколько источников истины:
- docs/vdad/*.md — человеко-читаемая документация
- .repoq/ontologies/*.ttl — онтологии (meta)
- .repoq/vdad/*.ttl — извлечённые данные VDAD
- Возможное дублирование: docs/vdad/phase2-values.md + docs/vdad/phase2-values.ttl (sidecar)

Вопрос: Где хранить единственный источник истины (Single Source of Truth, SSoT)?""" ;
        adr:constraint "Разработчики привыкли к Markdown" ;
        adr:constraint "RDF сложнее редактировать вручную" ;
        adr:constraint "Риск рассинхронизации Markdown ↔ RDF"
    ] ;

    # Decision
    adr:decision [
        a adr:Decision ;
        adr:description """.repoq/ — единственный источник истины для всех RDF-артефактов.

Workflow:
1. EDIT: .repoq/**/*.ttl (hand-edit RDF)
2. GENERATE: python scripts/generate_*.py
3. OUTPUT: docs/**/*.md (generated)
4. COMMIT: Both .ttl (source) and .md (generated)

Направление: RDF → Markdown (только одно направление!)"""
    ] ;

    # Consequences
    adr:consequence [
        a adr:Consequence ;
        adr:pros "Single Source of Truth: Один источник истины для всех данных" ;
        adr:pros "Reproducibility: manifest.json содержит checksums всех .repoq/**/*.ttl" ;
        adr:pros "Versioning: RDF эволюционирует вместе с кодом" ;
        adr:pros "Traceability: Все артефакты трассируются через RDF" ;
        adr:pros "SPARQL Queries: Единая база данных для запросов" ;
        adr:pros "Multi-format Export: RDF → Markdown, HTML, PDF, LaTeX, диаграммы" ;
        adr:pros "No Drift: Markdown всегда синхронизирован с RDF (generated)" ;
        adr:pros "Deterministic: RDF → Markdown преобразование детерминированное" ;

        adr:cons "Обучение: Разработчики должны работать с RDF напрямую" ;
        adr:cons "Tooling: Нужны RDF editors (Protégé, VS Code extensions)" ;
        adr:cons "Bootstrap: Первоначальная миграция Markdown → RDF (один раз)"
    ] ;

    # Alternatives
    adr:alternative [
        a adr:Alternative ;
        adr:alternativeName "Markdown as SSoT" ;
        adr:alternativeRationale "Отклонено: сложно делать SPARQL queries, трассировку, валидацию"
    ] ,
    [
        a adr:Alternative ;
        adr:alternativeName "Dual SSoT (Markdown + RDF sidecars)" ;
        adr:alternativeRationale "Отклонено: риск рассинхронизации, дублирование"
    ] ;

    # Traceability
    adr:implements vdad:fr-10 ;  # FR-10: Reproducible analysis
    adr:implements vdad:v07 ;    # V07: Observability
    adr:traces vdad:theorem-a ;  # Theorem A: Reproducibility

    # Related ADRs
    adr:relatedTo adr:adr-008 ;  # .repoq/ workspace structure
    adr:relatedTo adr:adr-010 ;  # Ontology-driven validation
    adr:relatedTo adr:adr-013 .  # Incremental migration strategy
