@prefix adr: <https://repoq.dev/ontology/adr#> .
@prefix vdad: <https://repoq.dev/ontology/vdad#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# ============================================================================
# ADR-014: Single Source of Truth — .repoq/ for all RDF artifacts
# ============================================================================

<https://repoq.dev/adr/ADR-014> a adr:ArchitectureDecisionRecord ;
    adr:id "ADR-014" ;
    adr:title "Single Source of Truth — .repoq/ for all RDF artifacts" ;
    adr:status adr:StatusAccepted ;
    adr:date "2025-01-15"^^xsd:date ;

    # Context
    adr:context [
        a adr:Context ;
        adr:problem """В проекте существует несколько источников истины:
- docs/vdad/*.md — человеко-читаемая документация
- .repoq/ontologies/*.ttl — онтологии (meta)
- .repoq/vdad/*.ttl — извлечённые данные VDAD
- Возможное дублирование: docs/vdad/phase2-values.md + docs/vdad/phase2-values.ttl (sidecar)

Вопрос: Где хранить единственный источник истины (Single Source of Truth, SSoT)?""" ;
        adr:constraint "Разработчики привыкли к Markdown" ;
        adr:constraint "RDF сложнее редактировать вручную" ;
        adr:constraint "Риск рассинхронизации Markdown ↔ RDF"
    ] ;

    # Decision
    adr:decision [
        a adr:Decision ;
        adr:description """.repoq/ — единственный источник истины для всех RDF-артефактов.

Workflow:
1. EDIT: .repoq/**/*.ttl (hand-edit RDF)
2. GENERATE: python scripts/generate_*.py
3. OUTPUT: docs/**/*.md (generated)
4. COMMIT: Both .ttl (source) and .md (generated)

Направление: RDF → Markdown (только одно направление!)"""
    ] ;

    # Consequences
    adr:consequence [
        a adr:Consequence ;
        adr:description "Single Source of Truth: Один источник истины для всех данных" ;
        adr:type "positive" ;
        adr:impact "high"
    ] ,
    [
        a adr:Consequence ;
        adr:description "Reproducibility: manifest.json содержит checksums всех .repoq/**/*.ttl" ;
        adr:type "positive" ;
        adr:impact "high"
    ] ,
    [
        a adr:Consequence ;
        adr:description "Versioning: RDF эволюционирует вместе с кодом" ;
        adr:type "positive" ;
        adr:impact "high"
    ] ,
    [
        a adr:Consequence ;
        adr:description "Traceability: Все артефакты трассируются через RDF" ;
        adr:type "positive" ;
        adr:impact "high"
    ] ,
    [
        a adr:Consequence ;
        adr:description "SPARQL Queries: Единая база данных для запросов" ;
        adr:type "positive" ;
        adr:impact "high"
    ] ,
    [
        a adr:Consequence ;
        adr:description "Multi-format Export: RDF → Markdown, HTML, PDF, LaTeX, диаграммы" ;
        adr:type "positive" ;
        adr:impact "medium"
    ] ,
    [
        a adr:Consequence ;
        adr:description "No Drift: Markdown всегда синхронизирован с RDF (generated)" ;
        adr:type "positive" ;
        adr:impact "high"
    ] ,
    [
        a adr:Consequence ;
        adr:description "Deterministic: RDF → Markdown преобразование детерминированное" ;
        adr:type "positive" ;
        adr:impact "medium"
    ] ,
    [
        a adr:Consequence ;
        adr:description "Обучение: Разработчики должны работать с RDF напрямую" ;
        adr:type "negative" ;
        adr:impact "medium"
    ] ,
    [
        a adr:Consequence ;
        adr:description "Tooling: Нужны RDF editors (Protégé, VS Code extensions)" ;
        adr:type "negative" ;
        adr:impact "low"
    ] ,
    [
        a adr:Consequence ;
        adr:description "Bootstrap: Первоначальная миграция Markdown → RDF (один раз)" ;
        adr:type "negative" ;
        adr:impact "medium"
    ] ;

    # Alternatives
    adr:alternative [
        a adr:Alternative ;
        adr:description "Markdown as SSoT: Хранить документацию в Markdown, генерировать RDF" ;
        adr:rationale "Отклонено: сложно делать SPARQL queries, трассировку, валидацию из Markdown"
    ] ,
    [
        a adr:Alternative ;
        adr:description "Dual SSoT (Markdown + RDF sidecars): Оба формата как источники истины" ;
        adr:rationale "Отклонено: риск рассинхронизации между форматами, дублирование"
    ] ;

    # Traceability
    adr:implements <https://repoq.dev/requirement/FR-10> ,
                   <https://repoq.dev/value/V07> ;
    adr:traces <https://repoq.dev/theorem/TheoremA> .

    # Related ADRs: Commented out until ADR-008/010/013 are created
    # adr:relatedTo <https://repoq.dev/adr/ADR-008> ,  # .repoq/ workspace structure
    #               <https://repoq.dev/adr/ADR-010> ,  # Ontology-driven validation
    #               <https://repoq.dev/adr/ADR-013> .  # Incremental migration strategy

