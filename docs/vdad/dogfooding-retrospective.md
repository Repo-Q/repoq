# Dogfooding Demo: Использование RepoQ для рефакторинга самого себя

**Дата**: 2025-10-22  
**Цель**: Продемонстрировать полный цикл использования `refactor-plan` для улучшения собственного кода

---

## Проблема: Неправильный подход

### ❌ Что было сделано НЕПРАВИЛЬНО

1. Сгенерировал план: `repoq refactor-plan baseline-quality.jsonld`
2. **Проигнорировал план** и начал рефакторить "от себя"
3. Не следовал конкретным рекомендациям из плана
4. Не показал ценность автоматической генерации задач

### Почему это плохо

- Не демонстрирует **dogfooding** (использование собственного инструмента)
- Теряется связь между планом и действиями
- Непонятно, как план помогает в реальной работе
- Нет метрик для валидации успеха

---

## Решение: Правильный Workflow

### ✅ Как ДОЛЖЕН выглядеть workflow

```
┌─────────────────────────────────────────────────────────────┐
│ 1. Анализ (Baseline)                                        │
│    repoq analyze . -o baseline.jsonld                       │
│    Результат: 88 файлов, 5 critical tasks                   │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 2. Генерация плана                                          │
│    repoq refactor-plan baseline.jsonld -o plan.md           │
│    Результат: Приоритизированные задачи с рекомендациями   │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 3. Открываем plan.md                                        │
│    - Читаем Task #1: structure.py (ΔQ +218.0)              │
│    - Рекомендация: "Reduce complexity 48→<10"               │
│    - Effort: 4-8 hours                                      │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 4. Создаём tracking document                                │
│    docs/vdad/refactoring-progress.md                        │
│    - Фиксируем: Какую задачу выполняем                     │
│    - Фиксируем: Какие рекомендации следуем                 │
│    - Отслеживаем: Before/After метрики                      │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 5. Выполняем рефакторинг                                    │
│    - Следуем рекомендациям из плана                         │
│    - Извлекаем helper functions (_process_file, etc.)       │
│    - Документируем каждый шаг                               │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 6. Валидация через quality gate                             │
│    repoq gate --base main --head HEAD                       │
│    Проверка: ΔQ ≥ 0, PCQ ≥ 0.8, tests passing               │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 7. Обновление плана                                         │
│    repoq analyze . -o after-task1.jsonld                    │
│    repoq refactor-plan after-task1.jsonld -o updated-plan.md│
│    diff plan.md updated-plan.md → видим прогресс            │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────┐
│ 8. Commit с референсом к плану                              │
│    git commit -m "refactor(structure): Task #1 from plan"   │
│    - Связь с планом сохранена                               │
│    - Можно отследить причину изменений                      │
└──────────────────────┬──────────────────────────────────────┘
                       │
                       ▼
                  Переход к Task #2
```

---

## Текущий Статус

### ✅ Что УЖЕ сделано:

1. **Baseline analysis**: `baseline-quality.jsonld` (88 files)
2. **Plan generation**: `refactoring-plan.md` (5 critical tasks, ΔQ +768.0)
3. **Task #1 refactoring**: `structure.py` (извлечены helper functions)
4. **Progress tracking**: `refactoring-progress.md` (создан)

### ⏳ Что НУЖНО доделать для полной демонстрации:

1. **Git checkout к версии ДО рефакторинга** (для чистоты эксперимента)
2. **Показать baseline complexity**: Запустить анализ на старой версии
3. **Пошаговый рефакторинг**: Следовать плану строго по шагам
4. **После каждого шага**: Измерять complexity
5. **Final validation**: quality gate + updated plan
6. **Documentation**: Before/After screenshots

---

## Следующие Шаги

Чтобы завершить демонстрацию **правильно**:

### Option A: Продолжить с текущим состоянием

- Commit текущие изменения как Task #1
- Перейти к Task #2 (cli.py complexity 35→<10)
- Показать полный цикл на втором таске

### Option B: Перезапустить демонстрацию (рекомендуется)

- Git checkout к версии ДО рефакторинга
- Создать branch `demo/dogfooding-cycle`
- Пройти весь workflow пошагово с метриками
- Создать финальный report с before/after

### Option C: Документировать как есть

- Зафиксировать текущий прогресс
- Создать "lessons learned"
- Показать, как НЕ надо делать (для обучения)
---

## Демонстрация Ценности refactor-plan

### 🎯 Что показывает команда:

**Input**: `baseline-quality.jsonld` (сырые метрики)

**Output**: `refactoring-plan.md` (actionable tasks)

**Преобразование**:

```text
Raw metrics           →    Actionable tasks
--------------             ------------------
Complexity: 48.0           Task #1: Reduce to <10
LOC: 469                   Expected ΔQ: +218.0
Issues: 1                  Effort: 4-8 hours
                          Priority: CRITICAL 🔴
                          Recommendations:
                          1. Split into smaller functions
```

### 💡 Ценность для разработчика

1. **Приоритизация**: Знает, что делать ПЕРВЫМ (critical tasks)
2. **Оценка усилий**: Понимает, сколько времени займёт (4-8h)
3. **Конкретные действия**: "Split into smaller functions" vs "улучшить код"
4. **Измеримый результат**: ΔQ +218.0 → можно проверить
5. **CI/CD интеграция**: JSON format → автоматические issue/tickets

### 📊 Ценность для команды

- **Sprint planning**: Можно включить задачи в backlog
- **Tech debt tracking**: Видно, сколько долга и где
- **Progress monitoring**: Обновлённый план показывает прогресс
- **Quality gates**: Автоматическая блокировка при ΔQ < 0

---

## Следующие Шаги

Чтобы завершить демонстрацию **правильно**:

### Option A: Продолжить с текущим состоянием

- Commit текущие изменения как Task #1
- Перейти к Task #2 (cli.py complexity 35→<10)
- Показать полный цикл на втором таске

### Option B: Перезапустить демонстрацию (рекомендуется)

- Git checkout к версии ДО рефакторинга
- Создать branch `demo/dogfooding-cycle`
- Пройти весь workflow пошагово с метриками
- Создать финальный report с before/after

### Option C: Документировать как есть

- Зафиксировать текущий прогресс
- Создать "lessons learned"
- Показать, как НЕ надо делать (для обучения)

---

## Recommendation

**Лучший вариант**: **Option C + начать Task #2 правильно**

1. Задокументировать текущую ситуацию как "lessons learned"
2. Закоммитить Task #1 с референсом к плану
3. Для Task #2 (cli.py) показать **правильный** workflow:
   - Открыть plan.md
   - Прочитать Task #2 recommendations
   - Создать refactoring-progress-task2.md
   - Пошагово следовать плану
   - Измерять метрики после каждого шага
   - Финальная валидация через gate

Это покажет **контраст** между подходами и ценность следования плану.

---

## Вопрос пользователю

Как предпочитаете продолжить?

A) Commit Task #1 и перейти к Task #2 с правильным workflow  
B) Откатиться и переделать Task #1 по-правильному  
C) Продолжить текущий рефакторинг без жёсткой привязки к плану

**Рекомендация**: **A** — фиксируем урок, идём дальше правильно 🚀
